<?xml version="1.0" ?>
<scene version='0.6.0'>

    <!-- Define default values. Scene length units are meters. -->
    <!-- Camera defaults -->
    <default name="cam_samples" value="128"/>
    <default name="cam_fov_y" value="TODO"/>
    <default name="cam_focus_distance" value="TODO"/>
    <default name="cam_pixel_aspect" value="TODO"/>
    <default name="cam_aperture_radius" value="TODO"/>
    <default name="cam_diff_limit" value="TODO"/>
    <default name="cam_pixel_format" value="rgba,luminance"/>
    <default name="cam_channel_names" value="color, distance"/>
    <default name="cam_image_width" value="TODO"/>
    <default name="cam_image_height" value="TODO"/>
    <default name="cam_crop_width" value="$cam_image_width"/>
    <default name="cam_crop_height" value="$cam_image_height"/>
    <default name="cam_crop_offset_x" value="0"/>
    <default name="cam_crop_offset_y" value="0"/>
    
    <!-- Projector defaults -->
    <default name="pro_pattern_file" value="TODO"/>
    <default name="pro_wrap_mode" value="black"/>
    <default name="pro_gamma" value="1.0"/>
    <default name="pro_transform" value="TODO"/>
    <default name="pro_intensity" value="TODO"/>
    <default name="pro_offset_x" value="TODO"/>
    <default name="pro_offset_y" value="TODO"/>
    <default name="pro_scale_x" value="TODO"/>
    <default name="pro_scale_y" value="TODO"/>
    <default name="pro_image_width" value="TODO"/>
    <default name="pro_image_height" value="TODO"/>
    <default name="pro_aperture_radius" value="TODO"/>
    <default name="pro_focus_distance" value="TODO"/>
    <default name="pro_diff_limit" value="TODO"/>
    <default name="pro_gap_size" value="0"/>
    <default name="pro_sampling_weight" value="5.0"/>
    
    <default name="amb_radiance" value="0.0"/>
    <default name="amb_sampling_weight" value="1.0"/>

    <!-- Object defaults -->
    <default name="obj_type" value="obj"/>
    <default name="obj_file" value="TODO"/>
    <default name="obj_max_smooth_angle" value="30.0"/>
    <default name="obj_mat_ior" value="TODO"/>
    <default name="obj_mat_alpha" value="TODO"/>    
    <default name="obj_mat_diffuse" value="TODO"/>    
    <default name="obj_flip_normals" value="false"/>    
    <default name="obj_transform" value="TODO"/>    
        
    <!-- Camera settings -->
    <sensor type="thinlens">
		    <transform name="toWorld">
			    <lookat origin="0, 0, 0" target="0, 0, 1" up="0, -1, 0"/>
		    </transform>
            <float name="fov" value="$cam_fov_y"/>
            <string name="fovAxis" value="y"/>
            <float name="pixelAspect" value="$cam_pixel_aspect"/>
		    <float name="focusDistance" value="$cam_focus_distance"/>
		    <float name="apertureRadius" value="$cam_aperture_radius"/>
            <float name="diffLimit" value="$cam_diff_limit"/>
            <float name="nearClip" value="0.001"/>
            <float name="farClip" value="100000"/>

		    <sampler type="halton">
		        <integer name="sampleCount" value="$cam_samples"/>
		    </sampler>

		    <film type="hdrfilm">
                <string name="pixelFormat" value="$cam_pixel_format"/>
                <string name="fileFormat" value="openexr"/>
                <string name="channelNames" value="$cam_channel_names"/>
                <string name="componentFormat" value="float32"/>
		        <integer name="width" value="$cam_image_width"/>
		        <integer name="height" value="$cam_image_height"/>
                <integer name="cropOffsetX" value="$cam_crop_offset_x"/>
                <integer name="cropOffsetY" value="$cam_crop_offset_y"/>
                <integer name="cropWidth" value="$cam_crop_width"/>
                <integer name="cropHeight" value="$cam_crop_height"/>
                <boolean name="banner" value="false"/>
                <rfilter type="box"/>
		    </film>
    </sensor>
    <!-- TODO Integrator settings need to be synced with hdrfilm channels/pixelformat -->
    <integrator type="multichannel">
        <integrator type="path">
            <integer name="maxDepth" value="128"/>
            <boolean name="hideEmitters" value="true"/>
        </integrator>
        <integrator type="field">
            <string name="field" value="distance"/>
        </integrator>
    </integrator>
    
    
    <!-- Projector and illumination settings -->
    <texture type="bitmap" id="projector_pattern">
        <string name="filename" value="$pro_pattern_file"/>
        <string name="wrapMode" value="$pro_wrap_mode"/>
        <string name="filterType" value="nearest"/>
        <boolean name="cache" value="false"/>
        <float name="gamma" value="$pro_gamma"/>
    </texture>

    <emitter type="spot">
        <ref name="texture" id="projector_pattern"/>
        <transform name="toWorld">
            <matrix value="$pro_transform"/>
        </transform>
        <spectrum name="intensity" value="$pro_intensity"/>
        <float name="offX" value="$pro_offset_x"/>
        <float name="offY" value="$pro_offset_y"/>
        <float name="scaleX" value="$pro_scale_x"/>
        <float name="scaleY" value="$pro_scale_y"/>
        <integer name="width" value="$pro_image_width"/>
        <integer name="height" value="$pro_image_height"/>
        <float name="apertureRadius" value="$pro_aperture_radius"/>
        <float name="focusDistance" value="$pro_focus_distance"/>
        <float name="diffLimit" value="$pro_diff_limit"/>
        <float name="gapSize" value="$pro_gap_size"/>
        <float name="samplingWeight" value="$pro_sampling_weight"/>        
    </emitter>
   
    <emitter type="constant">
        <spectrum name="radiance" value="$amb_radiance"/>
        <float name="samplingWeight" value="$amb_sampling_weight"/>
    </emitter>


    <!-- Object settings -->
    <shape type="$obj_type">
        <string name="filename" value='$obj_file'/>
        <float name="maxSmoothAngle" value="$obj_max_smooth_angle"/>
        <boolean name="flipNormals" value="$obj_flip_normals"/>

        <!-- TODO allow enabling material for vertex-colored objects-->
<!--        <bsdf type="diffuse">-->
<!--            <spectrum name="reflectance" value="0.0 1.0 1.0"/>-->
<!--            <texture type='vertexcolors' name="reflectance"/>-->
<!--        </bsdf>-->

        <!-- TODO enable switching off material for textured obj rendering -->
        <bsdf type="roughplastic">
            <string name="distribution" value="beckmann"/>
            <float name="intIOR" value="$obj_mat_ior"/>
            <float name="alpha" value="$obj_mat_alpha"/>
            <spectrum name="diffuseReflectance" value="$obj_mat_diffuse"/>
            <!--<float name="extIOR" value="1.01"/> -->
            <!--<spectrum name="specularReflectance" value="0.1"/> -->
        </bsdf>

        <transform name="toWorld">
            <matrix value="$obj_transform"/>
        </transform>
    </shape>

</scene>
